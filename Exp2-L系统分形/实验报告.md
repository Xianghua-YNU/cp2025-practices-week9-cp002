# L-System分形生成实验报告

## 一、实验目的

1. 掌握L-System的基本原理和实现方法
2. 理解符号重写规则和状态栈机制(`[]`)的工作原理
3. 实现科赫曲线和分形二叉树的生成与绘制
4. 分析不同参数对分形图形的影响

## 二、实验过程

### 1. 核心算法实现

**L-System字符串生成器(`apply_rules`函数):**
- 输入：公理(axiom)、规则字典(rules)、迭代次数(iterations)
- 处理：通过字符串替换实现迭代生成
- 输出：最终符号串

**L-System绘图器(`draw_l_system`函数):**
- 实现绘图状态管理(位置、角度)
- 处理分支结构(使用栈保存/恢复状态)
- 支持不同绘图指令(F, +, -, [, ]等)

### 2. 分形实现

**科赫曲线参数:**
- 公理: "F"
- 规则: {"F": "F+F--F+F"}
- 角度: 60°
- 迭代次数: 3-4次

**分形树参数:**
- 公理: "0" 
- 规则: {"1": "11", "0": "1[0]0"}
- 角度: 45°
- 迭代次数: 5-7次

### 3. 遇到的问题与解决

无

## 三、结果展示

### 1. 科赫曲线
![Koch Curve](l_system_koch.png)
<img width="439" alt="7c483193e0dc9f536c36a05a8c9b377" src="https://github.com/user-attachments/assets/375c90a7-e602-4570-8189-307729aebab0" />

- 迭代次数对曲线复杂度的影响：
- 随着迭代次数的增加，科赫曲线的复杂度显著提高。每次迭代都会在原曲线的基础上，将每一段直线替换为一个由更小线段组成的复杂结构，使得曲线的长度不断增加，细节更加丰富，图形越来越复杂。

- 自相似性特征分析：
科赫曲线具有严格的自相似性。无论放大或缩小曲线的局部，其形状都与整体相似。在不同的迭代次数下，曲线的各个部分都呈现出相似的结构和形态，只是规模不同。

### 2. 分形二叉树 
![Fractal Tree](fractal_tree.png)
<img width="247" alt="85aeb099c1cbac454ea58293dfff653" src="https://github.com/user-attachments/assets/7ff1da36-6273-4a4e-8765-9b7d82e07619" />

- 分支角度对树形结构的影响：
- 分支角度决定了分形二叉树的整体形状和空间分布。较小的分支角度会使树形结构较为紧凑，分支之间的重叠度较高；较大的分支角度则会使树形更加开阔，分支向更广泛的空间伸展，形成不同的视觉形态和空间结构。
- 迭代次数与分支密度的关系：
- 迭代次数与分支密度呈正相关。随着迭代次数的增加，分形二叉树的分支数量以指数形式增长，导致分支密度不断增大。每一次迭代都会在前一次的基础上产生更多的分支，使得树形结构越来越密集，填满空间的程度也越来越高。

## 四、分析与思考

1. **L-System特性分析**
   - 字符串重写与图形生成的对应关系：
   - L - System通过对初始字符串按照特定的重写规则进行迭代，将字符串中的字符与图形元素相对应，从而生成复杂的图形。例如，规定字符“F”表示向前绘制线段，“+”“-”表示旋转角度等，每次重写字符串就会改变图形的绘制方式，逐步生成具有分形特征的图形
   - 栈结构在分支处理中的作用；
   - 在L - System生成图形过程中，栈结构用于保存和恢复图形绘制的状态。当遇到分支指令时，当前的绘图状态（如位置、方向等）被压入栈中，然后进行分支的绘制。绘制完分支后，从栈中弹出之前保存的状态，继续后续的绘制，确保分支与其他部分正确连接和布局。

2. **参数影响实验**
   - 不同角度参数的效果对比：
   - 角度参数决定了图形中线段的旋转角度。较小的角度会使图形分支紧密，形成较为紧凑的形状；较大的角度则使分支分散，图形更加开阔、舒展，呈现出不同的外观特征。

   - 迭代次数与计算复杂度的关系：
   - 迭代次数增加，计算复杂度呈指数增长。因为每次迭代都要对字符串进行重写，并根据新字符串绘制图形，涉及大量字符处理和图形绘制操作，消耗的时间和空间资源增多。

3. **扩展思考**
   - 如何添加随机性使分形更自然：
   - 可以在重写规则中引入随机因素，如随机选择不同的重写规则，或随机调整角度、线段长度等参数，使分形图形在整体规律下呈现出局部的变化和多样性，更接近自然形态。

   - 其他经典分形的L-System规则设计：
   - 例如谢尔宾斯基三角形，可设定初始字符串和重写规则，如初始字符串为“A”，重写规则为“A→B - A - B”“B→A + B + A”，并规定相应的图形绘制规则来生成。
   - 与迭代函数系统(IFS)方法的比较：
   - L - System基于字符串重写，通过规则生成图形，更侧重于局部规则对整体图形的影响；IFS通过迭代一组仿射变换函数来生成分形，更注重图形的整体变换和收缩性质。L - System的规则相对直观，易于理解和修改；IFS在处理一些具有自相似变换性质的分形时效率较高。

4. **算法优化**
   - 提高绘图效率的方法:
   - 可以采用硬件加速，利用图形处理单元(GPU)的并行计算能力来绘制图形。还可以对图形进行缓存，避免重复绘制相同的部分，以及优化绘制顺序，减少图形状态的切换。

   - 大规模分形渲染的优化思路:
   - 采用层次化绘制，根据分形的层次结构，先绘制大致轮廓，再逐步细化细节。使用渐进式渲染，让用户先看到低分辨率的整体图形，随着时间推进逐渐提高分辨率。同时，合理利用空间索引结构，如四叉树或八叉树，快速定位和绘制可见部分，减少不必要的计算和绘制。

**注：请在每一部分补充你自己的实验内容、图像、分析和关键代码。**
